<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: January 28, 2023 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.0f229d4b7ebad1917a9a357cba2effab.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  


























  
  
  






  <meta name="author" content="Biography" />





  

<meta name="description" content="Controlling a inverted pendulum." />



<link rel="alternate" hreflang="en-us" href="https://rohitkjohnedu.github.io/project/example/" />
<link rel="canonical" href="https://rohitkjohnedu.github.io/project/example/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@wowchemy" />
  <meta property="twitter:creator" content="@wowchemy" />
<meta property="twitter:image" content="https://rohitkjohnedu.github.io/project/example/featured.jpg" />
<meta property="og:site_name" content="RKJ" />
<meta property="og:url" content="https://rohitkjohnedu.github.io/project/example/" />
<meta property="og:title" content="Inverted pendulum | RKJ" />
<meta property="og:description" content="Controlling a inverted pendulum." /><meta property="og:image" content="https://rohitkjohnedu.github.io/project/example/featured.jpg" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2016-04-27T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2016-04-27T00:00:00&#43;00:00">
  






    









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rohitkjohnedu.github.io/project/example/"
  },
  "headline": "Inverted pendulum",
  
  "image": [
    "https://rohitkjohnedu.github.io/project/example/featured.jpg"
  ],
  
  "datePublished": "2016-04-27T00:00:00Z",
  "dateModified": "2016-04-27T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Biography"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "RKJ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rohitkjohnedu.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Controlling a inverted pendulum."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Inverted pendulum | RKJ</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="e8f8d235e8e7f2efd912bfe865363fc3" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">RKJ</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">RKJ</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article article-project">

  






















  
  


<div class="article-container pt-3">
  <h1>Inverted pendulum</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Apr 27, 2016
  </span>
  

  

  

  
  
  
  

  
  

</div>

  




<div class="btn-links mb-3">
  
  








  


















  
  
  
    
  
  
  
  
  
    
  
  <a class="btn btn-outline-primary btn-page-header" href="https://twitter.com/georgecushen" target="_blank" rel="noopener">
    <i class="fab fa-twitter mr-1"></i>Follow</a>


</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 470px; max-height: 466px;">
  <div style="position: relative">
    <img src="/project/example/featured_hu5e0911612b383fa697bfe4b70e664cfd_7916_720x2500_fit_q75_h2_lanczos.webp" width="470" height="466" alt="" class="featured-image">
    <span class="article-header-caption">Photo by rawpixel on Unsplash</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h1 id="cart-pendulum">Cart Pendulum</h1>
<p>The cart pendulum is a simple device comprising of a pendulum attached to a movable cart. The cart in this example is capable of moving along the horizontal alone.</p>
<p>In this notebook, the equations govenring the dynamics of this device will be derived using Lagrangian dynamics and the sympy package. Later, an LQR control will be implemented to maintain the vertical position of the pendulum</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span><span class="p">,</span> <span class="n">rc</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sympy</span>  <span class="k">as</span> <span class="nn">sp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">control</span> <span class="k">as</span> <span class="nn">ct</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">control.matlab</span> <span class="k">as</span> <span class="nn">ct_matlab</span>
</span></span></code></pre></div><h1 id="deriving-the-equations">Deriving the equations</h1>
<p>We will derive the equations using Eulerâ€“Lagrange equation.</p>
<p>The Pendulum is assumed to be a mass at the end of a massless rod</p>
<p>The Variables</p>
<p>x1 : Position of the cart</p>
<p>x2 : Angles of the pendulum measured from the -y axis</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Time</span>
</span></span><span class="line"><span class="cl"><span class="n">t</span>  <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Time derivative</span>
</span></span><span class="line"><span class="cl"><span class="n">ddt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># States</span>
</span></span><span class="line"><span class="cl"><span class="n">x1</span>   <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x2</span>   <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x1d</span>  <span class="o">=</span> <span class="n">ddt</span><span class="p">(</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">x2d</span>  <span class="o">=</span> <span class="n">ddt</span><span class="p">(</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">x1dd</span> <span class="o">=</span> <span class="n">ddt</span><span class="p">(</span><span class="n">x1d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x2dd</span> <span class="o">=</span> <span class="n">ddt</span><span class="p">(</span><span class="n">x2d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Control input variable</span>
</span></span><span class="line"><span class="cl"><span class="n">u</span>   <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;m1, m2, l, g&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># positions. Here c: cart, p: pendulum</span>
</span></span><span class="line"><span class="cl"><span class="n">cart_x</span>   <span class="o">=</span> <span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cart_y</span>   <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">cart_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">cart_x</span><span class="p">,</span> <span class="n">cart_y</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pendulum_x</span>   <span class="o">=</span>  <span class="n">l</span><span class="o">*</span><span class="n">sp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pendulum_y</span>   <span class="o">=</span> <span class="o">-</span><span class="n">l</span><span class="o">*</span><span class="n">sp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">pendulum_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pendulum_x</span><span class="p">,</span> <span class="n">pendulum_y</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Velocities</span>
</span></span><span class="line"><span class="cl"><span class="n">cart_vel</span>     <span class="o">=</span> <span class="p">[</span><span class="n">ddt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cart_pos</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pendulum_vel</span> <span class="o">=</span> <span class="p">[</span><span class="n">ddt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pendulum_pos</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cart_v_squared</span>     <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cart_vel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pendulum_v_squared</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pendulum_vel</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="solving-the-langrange-equations">Solving the Langrange equations</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Energies</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Potential energy</span>
</span></span><span class="line"><span class="cl"><span class="n">pe</span> <span class="o">=</span> <span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">pendulum_y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Kinetic energy</span>
</span></span><span class="line"><span class="cl"><span class="n">ke</span> <span class="o">=</span> <span class="n">m1</span><span class="o">*</span><span class="n">cart_v_squared</span><span class="o">/</span><span class="mi">2</span>   <span class="o">+</span>   <span class="n">m2</span><span class="o">*</span><span class="n">pendulum_v_squared</span><span class="o">/</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Lagrangian</span>
</span></span><span class="line"><span class="cl"><span class="n">L</span> <span class="o">=</span> <span class="n">ke</span> <span class="o">-</span> <span class="n">pe</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The Differential equation</span>
</span></span><span class="line"><span class="cl"><span class="n">DEs</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">x1d</span><span class="p">))</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="n">u</span><span class="p">,</span> <span class="c1"># Fully coupled</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ddt(ddt(x1(t)))    - u,                     # When you dont want the dynamics of the pendulum to affect the cart</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">x2d</span><span class="p">))</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">DEs</span> <span class="o">=</span> <span class="p">[</span><span class="n">DE</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">DE</span> <span class="ow">in</span> <span class="n">DEs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Solving to get explicit values for the two state double derivatives</span>
</span></span><span class="line"><span class="cl"><span class="n">DEexplicit</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">DEs</span><span class="p">,</span>           <span class="p">[</span><span class="n">x1dd</span><span class="p">,</span> <span class="n">x2dd</span><span class="p">])</span> <span class="c1"># Solving</span>
</span></span><span class="line"><span class="cl"><span class="n">DEexplicit</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEexplicit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x1dd</span><span class="p">,</span> <span class="n">x2dd</span><span class="p">]]</span> <span class="c1"># Extracting the solutions</span>
</span></span><span class="line"><span class="cl"><span class="n">DEexplicit</span> <span class="o">=</span> <span class="p">[</span><span class="n">DE</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">DE</span> <span class="ow">in</span> <span class="n">DEexplicit</span><span class="p">]</span>  <span class="c1"># Simplifying the solution</span>
</span></span></code></pre></div><h4 id="substituting-the-state-which-are-functions-of-time-to-plain-symbols">Substituting the state which are functions of time to plain symbols</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y1d</span><span class="p">,</span> <span class="n">y2d</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;y1, y2, y1d, y2d&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">substitutions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> <span class="n">y1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> <span class="n">y2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span> <span class="n">y1d</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span> <span class="n">y2d</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">y1dd</span><span class="p">,</span> <span class="n">y2dd</span>    <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">substitutions</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">DEexplicit</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y1dd_function</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1d</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y2d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">y1dd</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">y2dd_function</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1d</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y2d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">y2dd</span><span class="p">)</span> 
</span></span></code></pre></div><h1 id="simulating">Simulating</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_PendulumCartRates</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">uf</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_</span> <span class="o">=</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">u</span>  <span class="o">=</span> <span class="n">uf</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">X_</span>
</span></span><span class="line"><span class="cl">    <span class="n">x1d</span> <span class="o">=</span> <span class="n">v1</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1d</span> <span class="o">=</span> <span class="n">y1dd_function</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x2d</span> <span class="o">=</span> <span class="n">v2</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2d</span> <span class="o">=</span> <span class="n">y2dd_function</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1d</span><span class="p">,</span> <span class="n">v1d</span><span class="p">,</span> <span class="n">x2d</span><span class="p">,</span> <span class="n">v2d</span><span class="p">])</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># System parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">param_vals</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;m1&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;m2&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;g&#34;</span>  <span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;l&#34;</span>  <span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># No control law, free moving</span>
</span></span><span class="line"><span class="cl"><span class="n">control_no</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mi">0</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Simulation parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
</span></span><span class="line"><span class="cl"><span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">tn</span> <span class="o">=</span> <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t_step</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initial condition</span>
</span></span><span class="line"><span class="cl"><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Integrate</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_PendulumCartRates</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">control_no</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m1&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m2&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;l&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;g&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">animte_CartPend</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Accepts cart state information and returns an animation
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Setting axes range</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>   <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">delta</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">ls</span><span class="p">:</span> <span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">aspect</span>  <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="n">x_range</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="n">y_range</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># setting matplotlib parameters</span>
</span></span><span class="line"><span class="cl">    <span class="n">scale</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aspect</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animation.html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jshtml&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Selecting the animation range</span>
</span></span><span class="line"><span class="cl">    <span class="n">res_plot</span> <span class="o">=</span> <span class="n">result</span><span class="p">[::</span><span class="mi">50</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ts_plot</span>  <span class="o">=</span> <span class="n">ts</span><span class="p">[::</span><span class="mi">50</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Setting up the plot</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>     <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">pend_plot</span><span class="p">,</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cart_plot</span><span class="p">,</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="s1">&#39;ks&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pend_plot</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="nb">iter</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_cart</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">th_pend</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">res_plot</span><span class="p">[</span><span class="nb">iter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">sub_obs</span>               <span class="o">=</span> <span class="p">{</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> <span class="n">x_cart</span><span class="p">,</span> <span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> <span class="n">th_pend</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;l&#34;</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">        <span class="n">x_pend</span><span class="p">,</span> <span class="n">y_pend</span>        <span class="o">=</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">N</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub_obs</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pendulum_pos</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">pend_plot</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x_cart</span><span class="p">,</span> <span class="n">x_pend</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_pend</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">cart_plot</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x_cart</span><span class="p">]</span>        <span class="p">,[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">res_plot</span><span class="p">),</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">anim</span> <span class="o">=</span> <span class="n">animte_CartPend</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span></code></pre></div><video controls width="250">
    <source src="./unforce.mp4" type="video/mp4">
</video>
<h1 id="control">Control</h1>
<h4 id="linearizing-the-systems">Linearizing the systems</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Storing the cumbersome partial derivative function in a lambda</span>
</span></span><span class="line"><span class="cl"><span class="n">ddx</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Defining variables to store rates of change</span>
</span></span><span class="line"><span class="cl"><span class="n">x1d_val</span><span class="p">,</span>  <span class="n">x2d_val</span>  <span class="o">=</span> <span class="n">x1d</span><span class="p">,</span> <span class="n">x2d</span>
</span></span><span class="line"><span class="cl"><span class="n">x1dd_val</span><span class="p">,</span> <span class="n">x2dd_val</span> <span class="o">=</span> <span class="n">DEexplicit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Storing states and their change in variables</span>
</span></span><span class="line"><span class="cl"><span class="n">Xs</span>  <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>   <span class="n">x1d</span><span class="p">,</span>      <span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>   <span class="n">x2d</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Xds</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1d_val</span><span class="p">,</span> <span class="n">x1dd_val</span><span class="p">,</span> <span class="n">x2d_val</span><span class="p">,</span> <span class="n">x2dd_val</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#  the stationary point Substitution</span>
</span></span><span class="line"><span class="cl"><span class="n">subs_stationary</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>      <span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddt</span><span class="p">(</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">A_sp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span> <span class="p">[</span>  <span class="n">ddx</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs_stationary</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Xs</span><span class="p">]</span>  <span class="k">for</span> <span class="n">xd</span> <span class="ow">in</span> <span class="n">Xds</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">B_sp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span> <span class="p">[</span>  <span class="n">ddx</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs_stationary</span><span class="p">)]</span>              <span class="k">for</span> <span class="n">xd</span> <span class="ow">in</span> <span class="n">Xds</span><span class="p">])</span>
</span></span></code></pre></div><h3 id="lqr-tuning">LQR tuning</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># The Parameters for substitution to get numerical values</span>
</span></span><span class="line"><span class="cl"><span class="n">param_subs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m1</span> <span class="p">:</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m1&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">m2</span> <span class="p">:</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span>  <span class="p">:</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;g&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">l</span>  <span class="p">:</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;l&#34;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Matrices with numerical values</span>
</span></span><span class="line"><span class="cl"><span class="n">A_np</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A_sp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">param_subs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">B_np</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B_sp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">param_subs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Q</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">R</span>     <span class="o">=</span> <span class="mf">0.001</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use the LQR algorithm </span>
</span></span><span class="line"><span class="cl"><span class="n">K_np</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ct_matlab</span><span class="o">.</span><span class="n">lqr</span><span class="p">(</span><span class="n">A_np</span><span class="p">,</span> <span class="n">B_np</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Simulation parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
</span></span><span class="line"><span class="cl"><span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">tn</span> <span class="o">=</span> <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t_step</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initial condition</span>
</span></span><span class="line"><span class="cl"><span class="n">x0</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set point</span>
</span></span><span class="line"><span class="cl"><span class="n">xsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Controller function</span>
</span></span><span class="line"><span class="cl"><span class="n">control_law</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">K_np</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xsp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Integrate</span>
</span></span><span class="line"><span class="cl"><span class="n">res_ctrl</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_PendulumCartRates</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">control_law</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m1&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;m2&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;l&#34;</span><span class="p">],</span> <span class="n">param_vals</span><span class="p">[</span><span class="s2">&#34;g&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">anim</span> <span class="o">=</span> <span class="n">animte_CartPend</span><span class="p">(</span><span class="n">res_ctrl</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</span></span></code></pre></div>
    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/control/">Control</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F&amp;text=Inverted&#43;pendulum" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F&amp;t=Inverted&#43;pendulum" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Inverted%20pendulum&amp;body=https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F&amp;title=Inverted&#43;pendulum" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Inverted&#43;pendulum%20https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Frohitkjohnedu.github.io%2Fproject%2Fexample%2F&amp;title=Inverted&#43;pendulum" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://rohitkjohnedu.github.io/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu80a27bf9bfaadc72f55f70271bf01878_789425_270x270_fill_q75_lanczos_center.jpg" alt="Biography"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://rohitkjohnedu.github.io/">Biography</a></h5>
      <h6 class="card-subtitle">Roboticist</h6>
      <p class="card-text">Elevating ideas from concept to reality through design, analysis, construction, and constant improvement</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/rohitkjohnedu" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/rohitkjohn/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















    <div class="project-related-pages content-widget-hr">
      
      

      
      
      

      
      
      
        <h2>Publications</h2>
        
          







  







  


<div class="media stream-item view-compact">
  <div class="media-body">

    <div class="section-subheading article-title mb-0 mt-0">
      <a href="/publication/conference-paper/" >An example conference paper</a>
    </div>

    
    <a href="/publication/conference-paper/"  class="summary-link">
      <div class="article-style">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis posuere tellus ac convallis placerat. Proin tincidunt magna sed ex sollicitudin condimentum.
      </div>
    </a>
    

    <div class="stream-meta article-metadata">

      

      
      <div>
        

  <span class="author-highlighted">
      <a href="/authors/admin/">Biography</a></span><i class="author-notes fas fa-info-circle" data-toggle="tooltip" title="Equal contribution"></i>, <span >
      <a href="/authors/robert-ford/">Robert Ford</a></span><i class="author-notes fas fa-info-circle" data-toggle="tooltip" title="Equal contribution"></i>
      </div>
      
    </div>

    
    <div class="btn-links">
      








  



<a class="btn btn-outline-primary btn-page-header btn-sm" href="/publication/conference-paper/conference-paper.pdf" target="_blank" rel="noopener">
  PDF
</a>



<a href="#" class="btn btn-outline-primary btn-page-header btn-sm js-cite-modal"
        data-filename="/publication/conference-paper/cite.bib">
  Cite
</a>


  
  
    
  
<a class="btn btn-outline-primary btn-page-header btn-sm" href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">
  Code
</a>


  
  
    
  
<a class="btn btn-outline-primary btn-page-header btn-sm" href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">
  Dataset
</a>



  
  <a class="btn btn-outline-primary btn-page-header btn-sm" href="/project/example/">
    Project
  </a>
  




  
  <a class="btn btn-outline-primary btn-page-header btn-sm" href="/slides/example/" target="_blank">
    Slides
  </a>
  


  
  
    
  
<a class="btn btn-outline-primary btn-page-header btn-sm" href="https://youtube.com" target="_blank" rel="noopener">
  Video
</a>


  
  
    
  
<a class="btn btn-outline-primary btn-page-header btn-sm" href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">
  Source Document
</a>




    </div>
    

  </div>
  <div class="ml-3">
    
    
      
      <a href="/publication/conference-paper/" >
        <img src="/publication/conference-paper/featured_hu3d03a01dcc18bc5be0e67db3d8d209a6_312700_150x0_resize_q75_h2_lanczos.webp" height="100" width="150"
            alt="An example conference paper" loading="lazy">
      </a>
    
  </div>
</div>

        
      

      
      
      
        <h2>Events</h2>
        
          







  







  


<div class="media stream-item view-compact">
  <div class="media-body">

    <div class="section-subheading article-title mb-0 mt-0">
      <a href="/talk/example-talk/" >Example Talk</a>
    </div>

    
    <a href="/talk/example-talk/"  class="summary-link">
      <div class="article-style">
        An example talk using Wowchemy&rsquo;s Markdown slides feature.
      </div>
    </a>
    

    <div class="stream-meta article-metadata">

      
      <div>
        <span>
          Jun 1, 2030 1:00 PM &mdash; 3:00 PM
        </span>
        
        <span class="middot-divider"></span>
        <span>Wowchemy HQ</span>
        
      </div>
      

      
    </div>

    
    <div class="btn-links">
      








  









  
  <a class="btn btn-outline-primary btn-page-header btn-sm" href="/project/example/">
    Project
  </a>
  




  
  <a class="btn btn-outline-primary btn-page-header btn-sm" href="/slides/example/" target="_blank">
    Slides
  </a>
  





  
  
  
    
  
  
  
  
  
    
  
  <a class="btn btn-outline-primary btn-page-header btn-sm" href="https://twitter.com/georgecushen" target="_blank" rel="noopener">
    <i class="fab fa-twitter mr-1"></i>Follow</a>


    </div>
    

  </div>
  <div class="ml-3">
    
    
      
      <a href="/talk/example-talk/" >
        <img src="/talk/example-talk/featured_hu3d03a01dcc18bc5be0e67db3d8d209a6_620088_150x0_resize_q75_h2_lanczos.webp" height="107" width="150"
            alt="Example Talk" loading="lazy">
      </a>
    
  </div>
</div>

        
      
    </div>
  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    Â© 2023 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> â€” the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":true}</script>



  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
